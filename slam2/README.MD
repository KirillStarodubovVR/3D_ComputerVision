# 3D-реконструкция по двумерным изображениям

## Введение

Мы будем использовать библиотеку OpenCV для выполнения 3D-реконструкции по 2D-изображениям.

Мы предполагаем простой сценарий, в котором у нас есть набор изображений объекта, сделанных с разных точек обзора одной и той же камерой. Камера откалибрована, и ее внутренние параметры известны. 

Алгоритм согласован с блок-схемой из слайдов ("Абсолютно любой SLAM").

## Использование

Скачайте изображения по следующей ссылке: [images](https://demuc.de/colmap/datasets/). В качестве отправной точки используйте набор данных South Building. 

Основной скрипт - `sfm.py`. Запустите его с помощью команды sfm.py --help, чтобы увидеть доступные опции.

Рекомендуется использовать его следующим образом:

``bash
python3 sfm.py --input <path> --num_features=10000 --resize_factor=0.5 --reprojection_threshold=1e-3 --ba_frequency=10 --vis_frequency=10 
```

Запустите скрипт с набором данных South Building.

## Реализация

Основаная часть (30 баллов):

Заполните недостающие части в файлах. Части, которые необходимо реализовать, отмечены символом `#TODO`.

## СОВЕТЫ

## 1. Обратите внимание, что ключевые точки уже не искажены и уже представленны как лучи на плоскости z=1 на этапе feature extracting. Вам не нужно делать это снова. Поэтому всякий раз, когда какой-либо метод требует матрицу камеры, какую матрицу камеры вы должны использовать? 

## 2. Извлечение и сопоставление ключевых точек занимает много времени. Поэтому они сохраняются. Если вы хотите пересчитать их, используйте флаг --recompute.

## 3. Архив содержит файл pointcloud_result.xyz, который содержит примерный результат реконструкции. Вы можете использовать его для проверки вашего решения. Его можно открыть в MeshLab или CloudCompare. 





# ДОПОЛНИТЕЛЬНО (20 баллов)

Реализуйте **ОДНО** или (по желанию) несколько из следующих расширений. Они перечислены в порядке возрастания сложности.

## 1. Сейчас сопоставление изображений выполняется брутфорсом. Каждое изображение сопоставляется со всеми другими изображениями. Сложность этого метода составляет O(n^2). Реализуйте один из предложенных методов из colmap, чтобы ускорить процесс сопоставления. Используя это расширение, реконструируйте набор данных Person Hall.

## 2. Уточните модель камеры с помощью bundle Adjustment. Вам нужно будет удалить шаг unproject из части извлечения и сопоставления фич и использовать исходные координаты пикселей. С помощью этого расширения реконструируйте сцену из набора данных Tanks and Temples: https://www.tanksandtemples.org/download/. 

## 3. Вместо использования gtSam реализуйте bundle adjustment с помощью numpy. Для этого потребуется вычислить якобиан ошибки репроекции. Дополнительную информацию можно найти здесь: https://ingmec.ual.es/~jlblanco/papers/jlblanco2010geometry3D_techrep.pdf

